---
layout: post
title: "小米手机刷机步骤（备忘）"
date: 2022-02-01 
description: ""
tag: 小米 刷机 Recovery
---

## 前言

我的忘性大，21年年初刷机了小米手机到国际版后，感觉用得挺不错的，就打算把岳母的红米NOTE 8也刷掉。具体操作时已经懵了，完全不记得当时的怎么操作的。于是我又重新找方法学习了一遍。为了避免之后再浪费时间找方法，我决定留个脚印，记录一个只需要我回来5分钟就能掌握的方法。

## 步骤

1. 解锁BL

2. 刷机

## 步骤展开

### 解锁BL

#### 什么是 BL 锁

BL 全名为 BootLoader，它在手机安全启动规范中属较底层的一环。以下是 BootLoader 在各类启动场景中的顺序。

> 系统启动：芯片内部固化 BootROM -> BootLoader -> Boot.img（Linux kernel 和 RAMDisk） -> System.img（Android）

> 卡刷启动：芯片内部固化 BootROM -> BootLoader -> Recovery.img -> 刷入卡刷包

> 线刷启动：芯片内部固化 BootROM -> BootLoader -> 刷入线刷包

BootLoader 会检查加载对象的签名信息（Boot.img 或 Recovery.img），如果签名与 OEM 厂商签发的不符将拒绝启动。在通过 BootLoader 检查后，后续步骤也会继续验证加载对象，Boot.img 检查 System.img 签名，Recovery.img 检查刷机包签名，如此环环相扣。

#### 为什么需要解 BL 锁

从上面介绍可以了解到，BL 锁主要作用是验证加载对象签名，防止启动第三方 ROM 或 Recovery，避免由此带来的数据安全风险。同时限制了 Fastboot 方式刷机（线刷），防范手机在没有授权的情况下被刷机。

对于合法刷机需求，小米保留有 BL 解锁渠道，在解锁后才能使用线刷方式刷机。小米 BL 解锁设计有多重验证，需在手机和解锁工具上登录相同小米帐号，并在手机插入 SIM 卡，进行数据联网等指定操作。

#### BL 解锁后有何变化

BL 解锁后赋予用户更多权限，可以自由刷第三方 ROM 和 Recovery，可以 Root 手机，相应的也会增加手机安全风险，仅适合高级用户。

对普通用户来说，解 BL 锁可能只为降级系统版本。这种只要确保 ROM 是官方原版，在刷机时选择锁定 BL 锁，安全性将不受影响。

注：如果刷国际版 ROM，则不能上锁，不然会无法启动系统。因为小米在 BL 加入了区域验证，国内版和国际版的签名信息不一致。

#### 小米手机 BL 解锁步骤

在解锁操作前，先确认自己的小米帐号是否可以解锁（即每月最多解锁 1 台手机，每年最多 4 台，超过需要更换帐号）。

帐号没问题后即可开始下面解锁步骤：

1. BL 解锁会清除手机数据，有数据的先做好备份
2. 手机已插入 SIM 卡，关闭 WiFi 连接，启用数据联网方式
3. 依次点击 手机设置 -> 我的设备 -> 全部参数 -> 连续点击几次“MIUI 版本” 打开开发者选项
4. 依次点击 手机设置 -> 更多设置 -> 开发者选项 -> 设备解锁状态 -> 绑定帐号和设备
5. 如果是新机，需在绑定帐号后保持使用 7 天，期间不要退出小米帐号，以满足解锁条件
6. 将手机与电脑连接一次，让电脑安装好驱动
7. 将手机关机，按住`音量下键 + 开机键`进入 Fastboot 模式，之后用数据线连接到电脑
8. 电脑[下载小米解锁工具](http://www.miui.com/unlock/)，解压后运行里面的 `miflash_unlock.exe` 文件，按提示登录小米帐号，点击解锁，解锁后重启手机
9. 到此，BL 解锁就完成了，之后便可以使用线刷方式刷机

注：如果解锁过程中遇到问题，需要重启手机，可长按开机键 10 秒退出 Fastboot 模式。

#### 小米手机 BL 解锁常见问题

1. BL 解锁后可以重新上锁吗
   
   可以在使用 MiFlash 刷机时，在界面右下角选择是否锁定 BL。

2. 解锁工具提示“账号设备不一致”
   
   检查手机登录小米帐号是否和线刷工具登录的一致。如果帐号相同，可尝试将手机系统升级到最新版再试。

3. 解锁工具提示“账号与设备没有绑定关系”
   
   如果用小米英文官网注册的帐号解锁国内版手机，可能出现此问题，需要注册国内帐号操作。



4. 解锁工具提示“无法获取手机信息”
   
   尝试更换数据线。如果电脑有 USB 2.0 端口，优先使用。此外最好用运行 64 位系统的电脑操作。

5. 解锁失败显示“未知错误-1”
   
   网路异常，检查电脑网络是否正常连接。

6. 解锁失败显示“账号权限不足或者账号受限”
   
   账号存在安全风险，无法执行解锁操作，建议更换账号。

### 线刷

#### 刷机准备事项

1. 线刷方式刷机会清除手机数据。因此手机如果有数据，请先备份数据。

2. 将手机充满电。电脑下载好要刷的 [MIUI 线刷包]([MIUI ROM DOWNLOAD - Xiaomi Community - Xiaomi](https://c.mi.com/global/miuidownload/index)) 和 [MiFlash 线刷工具](https://pan.chiphello.com:40272/手机刷机/小米/MiFlash2020-3-14-0.zip) 。

#### 刷机操作步骤

1. 先将手机关机（建议先退出小米账号），长按`音量下键 + 开机键`进入 Fastboot 模式，用数据线连接到电脑。

![mi-phone-fastboot](https://user-images.githubusercontent.com/85718974/151985309-e0c84dfa-b85f-47c5-94e9-879f3df52491.png)

2. 在之前解压的线刷工具文件夹里找到 `XiaoMiFlash.exe` 双击运行，软件界面点击“选择”按钮，选中解压的线刷包文件夹。

![miflash-1](https://user-images.githubusercontent.com/85718974/151985251-acf9f07b-3ce8-4f34-bfb1-a30480952ea4.png)

3. 这步是可选项，但强烈建议在线刷工具右下角选中“全部删除”模式，待之后确认刷机正常后再选“全部删除并lock”重新刷一遍（也可以不lock重刷。是否lock的区别是锁不锁BL，不锁后面刷机会方便一些，不用重新解锁，锁的话会提升安全性，但以后刷机要重新申请解锁才可以）。

之所以这样做是为降低刷机风险。如果后面刷机遇到意外问题，想要重新刷因为之前已默认 BL 上锁，刷机又要重新 BL 解锁。为避免这种情况，建议新手先选择不锁 BL 刷一遍，确认没问题后，再选择锁定 BL 重新刷入，这样比较稳妥。

注1：如果刷的是海外版 MIUI 系统，因为 BL 增加了区域限制检查，切记不要加 BL 锁刷机，不然启动不了系统。国内版系统则可以加 BL 锁。

注2：虽然 MiFlash 有保留用户数据刷机模式，但有时可能遇到刷完后某些应用不可用（如相册），建议最好手动备份数据，不要依赖这个功能。

![miflash-2](https://user-images.githubusercontent.com/85718974/151985419-c9ee545c-9ddf-440a-b30a-fd26dcca02df.png)

4. 点击“加载设备”，识别到手机设备后就可以点击刷机，刷机过程大概等待七八分钟，完成后手机会自动重启进入系统。

![miflash-4](https://user-images.githubusercontent.com/85718974/151985486-a7609b49-a6c7-40fc-abd0-0be8d7b8fa27.png)

点击刷机后等待数分钟，完成后手机会自动重启进入系统（有时线刷工具可能没有显示结果，只要手机正常重启进入系统初始化界面就行）





