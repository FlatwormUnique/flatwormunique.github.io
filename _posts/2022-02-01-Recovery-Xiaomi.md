---
layout: post
title: "小米手機刷機步驟（備忘）"
date: 2022-02-01 
description: ""
tag: 小米 刷機 Recovery
---

## 前言

我的忘性大，21年年初刷機了小米手機到國際版後，感覺用得挺不錯的，就打算把岳母的紅米NOTE 8也刷掉。具體操作時已經懵了，完全不記得當時的怎麼操作的。於是我又重新找方法學習了一遍。為了避免之後再浪費時間找方法，我決定留個腳印，記錄一個只需要我回來5分鐘就能掌握的方法。

## 步驟

1. 解鎖BL

2. 刷機

## 步驟展開

### 解鎖BL

#### 什麼是 BL 鎖

BL 全名為 BootLoader，它在手機安全啟動規範中屬較底層的一環。以下是 BootLoader 在各類啟動場景中的順序。

> 系統啟動：芯片內部固化 BootROM -> BootLoader -> Boot.img（Linux kernel 和 RAMDisk） -> System.img（Android）

> 卡刷啟動：芯片內部固化 BootROM -> BootLoader -> Recovery.img -> 刷入卡刷包

> 線刷啟動：芯片內部固化 BootROM -> BootLoader -> 刷入線刷包

BootLoader 會檢查加載對象的簽名信息（Boot.img 或 Recovery.img），如果簽名與 OEM 廠商簽發的不符將拒絕啟動。在通過 BootLoader 檢查後，後續步驟也會繼續驗證加載對象，Boot.img 檢查 System.img 簽名，Recovery.img 檢查刷機包簽名，如此環環相扣。

#### 為什麼需要解 BL 鎖

從上面介紹可以了解到，BL 鎖主要作用是驗證加載對象簽名，防止啟動第三方 ROM 或 Recovery，避免由此帶來的數據安全風險。同時限制了 Fastboot 方式刷機（線刷），防範手機在沒有授權的情況下被刷機。

對於合法刷機需求，小米保留有 BL 解鎖渠道，在解鎖後才能使用線刷方式刷機。小米 BL 解鎖設計有多重驗證，需在手機和解鎖工具上登錄相同小米帳號，並在手機插入 SIM 卡，進行數據聯網等指定操作。

#### BL 解鎖後有何變化

BL 解鎖後賦予用戶更多權限，可以自由刷第三方 ROM 和 Recovery，可以 Root 手機，相應的也會增加手機安全風險，僅適合高級用戶。

對普通用戶來說，解 BL 鎖可能只為降級系統版本。這種只要確保 ROM 是官方原版，在刷機時選擇鎖定 BL 鎖，安全性將不受影響。

註：如果刷國際版 ROM，則不能上鎖，不然會無法啟動系統。因為小米在 BL 加入了區域驗證，國內版和國際版的簽名信息不一致。

#### 小米手機 BL 解鎖步驟

在解鎖操作前，先確認自己的小米帳號是否可以解鎖（即每月最多解鎖 1 台手機，每年最多 4 台，超過需要更換帳號）。

帳號沒問題後即可開始下面解鎖步驟：

1. BL 解鎖會清除手機數據，有數據的先做好備份
2. 手機已插入 SIM 卡，關閉 WiFi 連接，啟用數據聯網方式
3. 依次點擊 手機設置 -> 我的設備 -> 全部參數 -> 連續點擊幾次「MIUI 版本」 打開開發者選項
4. 依次點擊 手機設置 -> 更多設置 -> 開發者選項 -> 設備解鎖狀態 -> 綁定帳號和設備
5. 如果是新機，需在綁定帳號後保持使用 7 天，期間不要退出小米帳號，以滿足解鎖條件
6. 將手機與電腦連接一次，讓電腦安裝好驅動
7. 將手機關機，按住`音量下鍵 + 開機鍵`進入 Fastboot 模式，之後用數據線連接到電腦
8. 電腦[下載小米解鎖工具](http://www.miui.com/unlock/)，解壓後運行裡面的 `miflash_unlock.exe` 文件，按提示登錄小米帳號，點擊解鎖，解鎖後重啟手機
9. 到此，BL 解鎖就完成了，之後便可以使用線刷方式刷機

註：如果解鎖過程中遇到問題，需要重啟手機，可長按開機鍵 10 秒退出 Fastboot 模式。

#### 小米手機 BL 解鎖常見問題

1. BL 解鎖後可以重新上鎖嗎
   
   可以在使用 MiFlash 刷機時，在界面右下角選擇是否鎖定 BL。

2. 解鎖工具提示「賬號設備不一致」
   
   檢查手機登錄小米帳號是否和線刷工具登錄的一致。如果帳號相同，可嘗試將手機系統升級到最新版再試。

3. 解鎖工具提示「賬號與設備沒有綁定關係」
   
   如果用小米英文官網註冊的帳號解鎖國內版手機，可能出現此問題，需要註冊國內帳號操作。



4. 解鎖工具提示「無法獲取手機信息」
   
   嘗試更換數據線。如果電腦有 USB 2.0 端口，優先使用。此外最好用運行 64 位系統的電腦操作。

5. 解鎖失敗顯示「未知錯誤-1」
   
   網路異常，檢查電腦網絡是否正常連接。

6. 解鎖失敗顯示「賬號權限不足或者賬號受限」
   
   賬號存在安全風險，無法執行解鎖操作，建議更換賬號。

### 線刷

#### 刷機準備事項

1. 線刷方式刷機會清除手機數據。因此手機如果有數據，請先備份數據。

2. 將手機充滿電。電腦下載好要刷的 [MIUI 線刷包]([MIUI ROM DOWNLOAD - Xiaomi Community - Xiaomi](https://c.mi.com/global/miuidownload/index)) 和 [MiFlash 線刷工具](https://pan.chiphello.com:40272/手機刷機/小米/MiFlash2020-3-14-0.zip) 。

#### 刷機操作步驟

1. 先將手機關機（建議先退出小米賬號），長按`音量下鍵 + 開機鍵`進入 Fastboot 模式，用數據線連接到電腦。![mi-phone-fastboot](https://user-images.githubusercontent.com/85718974/151985309-e0c84dfa-b85f-47c5-94e9-879f3df52491.png)
2. 在之前解壓的線刷工具文件夾里找到 `XiaoMiFlash.exe` 雙擊運行，軟件界面點擊「選擇」按鈕，選中解壓的線刷包文件夾。![miflash-1](https://user-images.githubusercontent.com/85718974/151985251-acf9f07b-3ce8-4f34-bfb1-a30480952ea4.png)
3. 這步是可選項，但強烈建議在線刷工具右下角選中「全部刪除」模式，待之後確認刷機正常後再選「全部刪除並lock」重新刷一遍（也可以不lock重刷。是否lock的區別是鎖不鎖BL，不鎖後面刷機會方便一些，不用重新解鎖，鎖的話會提升安全性，但以後刷機要重新申請解鎖才可以）。之所以這樣做是為降低刷機風險。如果後面刷機遇到意外問題，想要重新刷因為之前已默認 BL 上鎖，刷機又要重新 BL 解鎖。為避免這種情況，建議新手先選擇不鎖 BL 刷一遍，確認沒問題後，再選擇鎖定 BL 重新刷入，這樣比較穩妥。

注1：如果刷的是海外版 MIUI 系統，因為 BL 增加了區域限制檢查，切記不要加 BL 鎖刷機，不然啟動不了系統。國內版系統則可以加 BL 鎖。

注2：雖然 MiFlash 有保留用戶數據刷機模式，但有時可能遇到刷完後某些應用不可用（如相冊），建議最好手動備份數據，不要依賴這個功能。
![miflash-2](https://user-images.githubusercontent.com/85718974/151985419-c9ee545c-9ddf-440a-b30a-fd26dcca02df.png)

4. 點擊「加載設備」，識別到手機設備後就可以點擊刷機，刷機過程大概等待七八分鐘，完成後手機會自動重啟進入系統。
![miflash-4](https://user-images.githubusercontent.com/85718974/151985486-a7609b49-a6c7-40fc-abd0-0be8d7b8fa27.png)

點擊刷機後等待數分鐘，完成後手機會自動重啟進入系統（有時線刷工具可能沒有顯示結果，只要手機正常重啟進入系統初始化界面就行）

## 後記
資料大部分來自於[MIUI歷史版本](https://miuiver.com/)
根據自己的使用習慣有刪改。

