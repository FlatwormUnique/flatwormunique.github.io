layout: post
title: "群晖DSM系统安装8156B芯片网卡驱动"
date: 2021-06-12 
description: "8156B几乎支持近5年的所有群晖机型"
tag: 群晖 DSM 黑群晖 网卡 2.5G 8156B

# 前言

开始教程前，请先确定您的DSM系统的版本，目前只支持DSM6.2.x ，如果您的版本已经更新至DSM 7.x，请按照下面的教程降级。

>  群晖DSM7.x降级到6.2教程，解决降级后测试套件存在无法安装启用 
>
>  https://dx2.cc/77.html 
>
> （@单行独立博客 

# 一.下载驱动文件

感谢由Github大神@[bb-qq](https://github.com/bb-qq) 提供驱动文件，目前他还在维护这个项目，期待他做出支持DSM 7.x的驱动。

[Releases · bb-qq/r8152 (github.com)](https://github.com/bb-qq/r8152/releases)

**虽然文件名r8152好像是只支持RTL8152芯片，不过经过测试同样支持RTL8153、RTL8156、RTL8156B芯片。**

目前的最新版本是2.15.0-1，点进来发现有很多个驱动，下载哪一个合适呢？



请参照下方的表格

| 驱动版本                                                     | 型号                                                         |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| r8152-apollolake-2.14.0-2.spk                                | DS218+、DS418play、DS718+、DS918+、DS1019+、DS620slim        |
| r8152-armada375-2.14.0-2.spk                                 | DS115、DS215j                                                |
| r8152-armada38x-2.14.0-2.spk                                 | DS218j、DS416j、DS416slim、DS216、DS216j、DS116              |
| r8152-armadaxp-2.14.0-2.spk                                  | DS414、DS214+、DS214、RS814、RS815                           |
| r8152-avoton-2.14.0-2.spk                                    | DS415+、DS1817+、DS1517+、RS2416+、RS815+、DS2415+、DS1815+、DS1515+ |
| r8152-braswell-2.14.0-2.spk                                  | DS216+、DS216+II、DS416play、DS716+、DS716+II、DS916+        |
| r8152-broadwell-2.14.0-2.spk                                 | RS3618xs、DS3617xs、RS3617xs+、RS3617RPxs、FS2017、FS3400    |
| r8152-rtd1296-2.14.0-2.spk                                   | DS420j、DS220j、RS819、DS418、DS218、DS218play、DS118        |
| r8152-monaco-2.14.0-2.spk                                    | DS216play                                                    |
| r8152-denverton-2.14.0-2.spk                                 | DS1618+、RS2418+、RS2818RP+、DS1819+、DS2419+、RS820+        |
| r8152-v1000-2.14.0-2b.spk                                    | DS1621+、DS1821+、RS1221+、RS2421+、RS2821RP+                |
| r8152-geminilake-2.14.0-2.spk                                | DS1520+、DS920+、DS720+、DS420+、DS220+                      |
| 本表格包含大部分常见型号，请您自行查阅，如您的群晖型号不在此列，请移步群晖官网查阅。 |                                                              |

群晖官网查询地址：[What kind of CPU does my Synology NAS have? - Synology Knowledge Center](https://kb.synology.com/en-global/DSM/tutorial/What_kind_of_CPU_does_my_NAS_have)

r8152-apollolake-2.14.0-2.spk ，比如这个驱动，中间的apollolake就是您机器的CPU的代号，您可以通过官网的表格来查询。

```
快捷键查询：Ctrl+F
```

# 二.修改网卡个数

这是至关重要的一步，很多朋友驱动不了都是这一步的问题

群晖的某些机型如DS918+不支持超过2个网卡，那么新增的这个USB网卡自然是不能识别（有些机型可以识别但是灰色无法激活使用），那么我们现在需要通过SSH在Linux命令行下来修改最高支持的网卡数量。注意，DS3617xs等机型可以忽略这一步，其本身支持更多的网卡。

看到需要操作命令行，有些朋友已经摇头准备右上角了，且慢，本教程会尽量说明白，不懂命令行的朋友们不要有压力，你可以的。

## 1.开启电脑的SHH服务

MacOS、Linux系统无需操作

Windows系统：Windows设置→应用→应用和功能→可选功能→添加功能→添加Openssh服务

## 2.SHH登录群晖操作

MacOS、Linux系统可以直接使用“终端”

Windows系统：cmd打开“命令提示符”

输入ssh 你的群晖id@你的群晖地址实例：

```
ssh huanghuanas@192.168.0.52
```

回车之后输入群晖登录密码

登录成功后输入sudo -i 获得root权限

```
sudo -i
```

回车之后再次输入群晖登录密码

## 3.修改文件

```
vi /etc.defaults/synoinfo.conf
```

找到如下字段

> ```text
> support_syno_hybrid_raid="yes"
> vpn_conn_max="30"
> maxlanport=“2”
> supportraidcross="yes"
> max_iscsitrgs="128"
> ```

把第三行maxlanport=“2”中的2修改成比2大的数字，取决于您想添加几块网卡。

修改完成后按下Esc键退出，输入

```
:wq
```

上面的代码是强制性写入文件并退出的意思。

```
vi /etc/synoinfo.conf
```

和刚刚的操作一样，我们输入上面的命令之后同样找到maxlanport=“2”这个字段修改。

修改完成后按下Esc，输入:wq保存并退出。

至此，群晖的网卡数量修改就完成了，是不是比想象的简单。

# 三.安装驱动

登录到群晖的WEB界面，打开套件中心，手动安装我们之前下载的spk驱动文件。

将网卡连接至群晖的USB3.0接口，重启。

顺利的话，大功告成！

# 四.并不顺利

参考关于各种疑难杂症的另一篇日志